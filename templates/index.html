<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Convertidor de Intereses</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at center, #1f1f1f, #121212);
    color: #f5f5f5;
    height: 100vh;
    display: grid;
    place-items: center;
    padding: 1rem;
  }

  section.conversor-wrapper {
    background: #232323;
    border-radius: 20px;
    padding: 3rem 2rem;
    width: 100%;
    max-width: 420px;
    box-shadow: 0 0 40px rgba(0, 255, 255, 0.1);
  }

  header h2 {
    text-align: center;
    margin-bottom: 2rem;
    font-size: 1.8rem;
    color: #00e5ff;
  }

  form.converter-form {
    display: flex;
    flex-direction: column;
    gap: 1.4rem;
  }

  label {
    font-size: 0.9rem;
    color: #bbb;
    margin-bottom: 0.3rem;
    display: block;
  }

  input[type="number"],
  select {
    padding: 0.75rem 1rem;
    background-color: #2e2e2e;
    border: 1px solid #444;
    border-radius: 12px;
    color: #fefefe;
    font-size: 1rem;
    box-shadow: inset 0 0 5px #000;
    transition: all 0.25s ease;
    width: 100%;
    appearance: none;
  }

  input:focus,
  select:focus {
    border-color: #00e5ff;
    outline: none;
    box-shadow: 0 0 6px #00e5ff88, inset 0 0 5px #00e5ff33;
    background-color: #262626;
  }

  select {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg fill='%23ccc' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1.2rem;
    padding-right: 3rem;
  }

  select:hover {
    background-color: #2a2a2a;
    cursor: pointer;
  }

  button {
    padding: 0.8rem;
    background: linear-gradient(90deg, #00e5ff, #00bcd4);
    color: #000;
    font-weight: bold;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  button:hover {
    background: linear-gradient(90deg, #00bcd4, #00e5ff);
  }

  .feedback {
    margin-top: 1.5rem;
    text-align: center;
  }

  .feedback .resultado {
    color: #00e676;
    font-size: 1.4rem;
    font-weight: bold;
  }

  .feedback .error {
    color: #ff5252;
    font-size: 1rem;
  }

  @media (max-width: 480px) {
    section.conversor-wrapper {
      padding: 2rem 1.5rem;
    }

    header h2 {
      font-size: 1.5rem;
    }
  }
</style>
</head>
<body>
  <section class="conversor-wrapper">
    <header>
      <h2>Convertidor de Intereses</h2>
    </header>

    <form class="converter-form" method="post">
      <div>
        <label for="valor">Tasa a convertir (%)</label>
        <input type="number" step="0.01" id="valor" min="0" name="valor" required
               value="{{ form_vals.valor }}" placeholder="Ej: 12.5" />
      </div>

      <!-- ORIGEN -->
      <div>
        <label for="origen_tipo">Tipo de tasa original</label>
        <select name="origen_tipo" id="origen_tipo" required>
          <option value="" disabled {% if not form_vals.origen_tipo %}selected{% endif %}>Selecciona tipo</option>
          <option value="nominal" {% if form_vals.origen_tipo=='nominal' %}selected{% endif %}>Nominal (anual convertible n)</option>
          <option value="efectiva" {% if form_vals.origen_tipo=='efectiva' %}selected{% endif %}>Efectiva por período</option>
          <option value="efectiva_anual" {% if form_vals.origen_tipo=='efectiva_anual' %}selected{% endif %}>Efectiva anual (TEA)</option>
        </select>
      </div>

      <div>
        <label for="origen_periodo">Periodo original</label>
        <select name="origen_periodo" id="origen_periodo" required>
          <option value="" disabled {% if not form_vals.origen_periodo %}selected{% endif %}>Selecciona periodo</option>
          {% for p in periodos %}
            <option value="{{ p }}" {% if form_vals.origen_periodo==p %}selected{% endif %}>{{ p|capitalize }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label for="tipo_tiempo_origen">Timing de la tasa original</label>
        <select name="tipo_tiempo_origen" id="tipo_tiempo_origen" required>
          <option value="" disabled {% if not form_vals.tipo_tiempo_origen %}selected{% endif %}>¿Anticipada o vencida?</option>
          <option value="vencida" {% if form_vals.tipo_tiempo_origen=='vencida' %}selected{% endif %}>Vencida</option>
          <option value="anticipada" {% if form_vals.tipo_tiempo_origen=='anticipada' %}selected{% endif %}>Anticipada</option>
        </select>
      </div>

      <!-- DESTINO -->
      <div>
        <label for="destino_tipo">Tipo de tasa destino</label>
        <select name="destino_tipo" id="destino_tipo" required>
          <option value="" disabled {% if not form_vals.destino_tipo %}selected{% endif %}>Selecciona tipo</option>
          <option value="nominal" {% if form_vals.destino_tipo=='nominal' %}selected{% endif %}>Nominal (anual convertible n)</option>
          <option value="efectiva" {% if form_vals.destino_tipo=='efectiva' %}selected{% endif %}>Periódica</option>
          <option value="efectiva_anual" {% if form_vals.destino_tipo=='efectiva_anual' %}selected{% endif %}>Efectiva anual (TEA)</option>
        </select>
      </div>

      <div>
        <label for="destino_periodo">Periodo destino</label>
        <select name="destino_periodo" id="destino_periodo" required>
          <option value="" disabled {% if not form_vals.destino_periodo %}selected{% endif %}>Selecciona periodo</option>
          {% for p in periodos %}
            <option value="{{ p }}" {% if form_vals.destino_periodo==p %}selected{% endif %}>{{ p|capitalize }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label for="tipo_tiempo_destino">Timing de la tasa destino</label>
        <select name="tipo_tiempo_destino" id="tipo_tiempo_destino" required>
          <option value="" disabled {% if not form_vals.tipo_tiempo_destino %}selected{% endif %}>¿Anticipada o vencida?</option>
          <option value="vencida" {% if form_vals.tipo_tiempo_destino=='vencida' %}selected{% endif %}>Vencida</option>
          <option value="anticipada" {% if form_vals.tipo_tiempo_destino=='anticipada' %}selected{% endif %}>Anticipada</option>
        </select>
      </div>

      <button type="submit">Calcular Conversión</button>
    </form>

    <article class="feedback">
      {% if resultado is not none %}
        <div class="resultado">
          Resultado {{ etiqueta }}: {{ "%.6f"|format(resultado) }}%
        </div>
      {% endif %}
      {% if error %}
        <div class="error">{{ error }}</div>
      {% endif %}
    </article>
  </section>

  <script>
    const origenTipo = document.getElementById('origen_tipo');
    const origenTiming = document.getElementById('tipo_tiempo_origen');
    const destinoTipo = document.getElementById('destino_tipo');
    const destinoTiming = document.getElementById('tipo_tiempo_destino');

    function lockTimingIfEffective(selectTipo, selectTiming) {
      const t = selectTipo.value;
      const isEff = (t === 'efectiva' || t === 'efectiva_anual');
      [...selectTiming.options].forEach(o => {
        if (o.value === 'anticipada') o.disabled = isEff;
      });
      if (isEff) selectTiming.value = 'vencida';
    }

    function syncAll() {
      lockTimingIfEffective(origenTipo, origenTiming);
      lockTimingIfEffective(destinoTipo, destinoTiming);
    }

    origenTipo.addEventListener('change', syncAll);
    destinoTipo.addEventListener('change', syncAll);
    document.addEventListener('DOMContentLoaded', syncAll);
  </script>
</body>
</html>